<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>webpageMaker</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body{font-family:'Poppins',sans-serif;line-height:1.4;color:#1a1a1a;background:#f0f4f8;margin:0;padding:0}
    .header{padding:.8rem .8rem .8rem 1.8rem;font-weight:600;font-size:1.3rem;color:white;border-radius:3px;
            background:linear-gradient(135deg,#ff6b6b,#4ecdc4);box-shadow:0 3px 6px gray}
    .container{width:100%;max-width:35rem;margin:0 auto;padding:1.5rem 1rem;background:#F7EDF4;
               border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,.05);box-sizing:border-box}
    h2{font-size:2rem;color:#2c3e50;margin-bottom:1.3rem;font-weight:700;border-bottom:3px solid #ff6b6b;
       padding-bottom:.5rem;transition:color .3s}h2:hover{color:#FB6D6D}
    h3{font-size:1rem;color:#3CA29A;font-weight:600}
    p,ul{font-size:1rem;color:#4a4a4a;margin-bottom:.8rem}
    ul{padding-left:1rem;list-style:none}
    ol{padding-left:1rem;}
    ul>li{margin-bottom:.8rem;position:relative;padding-left:.8rem}
    ul>li:before{content:'•';color:#ff6b6b;position:absolute;left:0;top:.2rem}

    /*hangin indent*/
    li {
      padding-left:1rem; text-indent: -1rem;
    }
    /*end hangin indent*/

    a{color:#FF14BA;text-decoration:none;transition:color .3s}a:hover{color:#4ecdc4;text-decoration:underline}
    .section{border:thin solid #F6C1E6;background:#f9f9f9;padding:1rem;border-radius:8px;
             margin-bottom:1.1rem;transition:transform .3s,box-shadow .3s;position:relative}
    .section:hover{transform:translateY(-5px);box-shadow:0 6px 12px rgba(0,0,0,.1)}
    .sectionTop{border:thin solid #F6C1E6;background:#f9f9f9;padding:1rem;border-radius:8px;margin-bottom:1.1rem}
    #sectionTemplate{display:none}
    .editor-panel{position:fixed;top:10px;right:10px;background:rgba(255,255,255,.97);padding:14px;
                  border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,.15);z-index:9999;
                  font-family:'Poppins',sans-serif;font-size:.85rem;min-width:10rem;max-width:15rem;}
    .editor-panel input,.editor-panel button{width:100%;margin:6px 0;padding:8px 10px;
                  font-size:.85rem;border:1px solid #ddd;border-radius:6px}
    .editor-panel button{background:#ff6b6b;color:white;font-weight:600;cursor:pointer;
                        transition:background .3s}
    .editor-panel button:hover{background:#4ecdc4}
    .delBtn,.link-del{background:#ff6b6b;color:white;border:none;padding:2px 6px;
                      font-size:.65rem;cursor:pointer;border-radius:3px;margin-left:8px}
    .edit-spacer{height:1px;margin:8px 0;user-select:none;contenteditable:false}
    .editMode{display:block}


#btnSave{
  background-color:blue; font-size:1rem;
}


    /* AUDIO LINKS STYLING */
    #audioLinks {
        margin: 1.1rem 0;
        text-align: center;
    }
    #audioLinks > div:first-child {
        font-weight: 600;
        font-size: 1rem;
        margin-bottom: 1rem;
        color: #2c3e50;
    }

    .audio-link-wrapper {
        display: flex;
        align-items: center;
        margin-bottom: 18px;
        position: relative;
    }

    .fake-player-bar {
        display: flex;
        align-items: center;
        background: #e8ecef;
        padding: 5px 7px;
        border-radius: 10px;
        box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        flex: 0 0 60%;
        transition: background 0.2s, transform 0.2s;
    }

    .fake-player-bar:hover {
        background: #d8e2ec;
        transform: translateY(-3px);
    }

    .play-emoji {
        font-size: 28px;
        margin-right: 16px;
        flex-shrink: 0;
    }

    .progress-track {
        flex: 1;
        height: 7px;
        background: #bbb;
        border-radius: 4px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        width: 20%;
        background: #ff9500; /* matches orange ▶️ */
    }

    .audio-label {
        margin-left: 18px;
        font-weight: 600;
        font-size: 1.05rem;
        color: #2c3e50;
    }

    .audio-del {
        position: absolute;
        right: -30px;
        background: #6a5acd;
        color: white;
        border: none;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        font-size: 14px;
        cursor: pointer;
        /* No display: none or block here — let .editMode control it globally */
    }

  </style>
</head>
<body>
  <!-- EDITOR PANEL -->
  <div class="editor-panel editMode">
    <div style="margin-bottom:1.2rem;"><strong>Editor Tools</strong></div>
    <hr>
    <label style="display: inline; cursor: pointer;"><b>Unordered List</b><br>Use ^^ for delimiter<br>
        <input type="checkbox" id="olCheckbox" style="display: inline-block; vertical-align: middle; margin: 0 4px 0 0; width: auto; height: auto;">Change to Ordered List
</label>
<button id="formatBtn">Make List</button>

<hr>


    <label>Display Text<br><input id="linkText" placeholder="e.g. Watch on YouTube"></label>
    <label>URL<br><input id="linkUrl" placeholder="e.g. https://youtu.be/..."></label>

    <button id="btnAddLink">+ Add Link</button>
    <button id="btnAddAudioLink">+ Add Podcast Player w/Link</button>
    <hr>

    <hr>
     <button id="btnAdd">+ Add Section</button>
     <hr>
    <label>Save As<br><input id="filenameInput" value="myPodcastPage.html"></label>
    <button id="btnSave">Save to Local File</button>
  </div>
  <div class="container">
    <div class="header" contenteditable="true">Dr. Ray's English Lessons</div><br>
    <div class="sectionTop" contenteditable="true">
      <h2 id="articleTitle" style="color:#3CA29A;">Top Header/Title Goes Here</h2>
      <p>An overview or summary goes here ... [or anything else you like]</p>
      <div id="linksSection" style="text-align:right;width:100%"></div>
    </div><br>
    <!-- AUDIO BLOCK -->
<div id="audioLinks">
  <div>Listen to Podcast
    <button class="delBtn editMode"
            onclick="this.parentElement.remove()">delete title only</button>
  </div>
</div>




    <!-- TEMPLATE -->
    <div id="sectionTemplate">
      <h3>New Section</h3>
        <div>  [Type or past text here] </div>
      <button class="delBtn editMode" onclick="this.parentElement.remove()">delete section</button>
    </div>


    <!-- SECTION 1 -->
    <div class="section" contenteditable="true">
      <h3>Some Subtitle Goes Here</h3>
        <div>  [Type or past text here] </div>
      <button class="delBtn editMode" onclick="this.parentElement.remove()">delete section</button>
    </div>
    <div class="edit-spacer editMode" contenteditable="false"></div>
  </div>


<script>
document.addEventListener('DOMContentLoaded', () => {

  const $ = s => document.querySelector(s);
  const linkText = $('#linkText');
  const linkUrl = $('#linkUrl');
  //const audioIn = $('#audioInput');
  const fileIn = $('#filenameInput');
  const linksSec = $('#linksSection');
  const audioLinksSec = $('#audioLinks');
  const container = $('.container');


// TOP-RIGHT LINKS DELETE (delegation)
linksSec.addEventListener('click', (e) => {
  if (e.target.classList.contains('link-del')) {
    e.target.previousElementSibling.remove(); // remove the <a>
    e.target.remove();                        // remove the X button
  }
});


  audioLinksSec.addEventListener('click', (e) => {
  if (e.target.classList.contains('audio-del')) {
    e.target.parentElement.remove();
  }
});

 // ADD REGULAR LINK (top right)
  // ADD REGULAR LINK - now uses delegation
  $('#btnAddLink').onclick = () => {
    const text = linkText.value.trim();
    const url = linkUrl.value.trim();
    if (!text || !url) return alert('Fill both fields');

    const link = document.createElement('a');
    link.href = url;
    link.target = '_blank';
    link.textContent = text;
    link.style = 'font-size:92%; display:block; text-align:right;';

    const del = document.createElement('button');
    del.textContent = 'X';
    del.className = 'link-del editMode';
    del.style = 'margin-left:8px; font-size:0.7rem;';
    // NO onclick here — handled by delegation below

    linksSec.appendChild(link);
    linksSec.appendChild(del);

    linkText.focus();
  };

   // ADD AUDIO LINK - now uses delegation
  $('#btnAddAudioLink').onclick = () => {
    const text = linkText.value.trim();
    const url = linkUrl.value.trim();
    if (!text || !url) return alert('Fill both fields');

    const wrapper = document.createElement('div');
    wrapper.className = 'audio-link-wrapper';

    const del = document.createElement('button');
    del.textContent = 'X';
    del.className = 'audio-del editMode';
    // NO onclick here

    const a = document.createElement('a');
    a.href = url;
    a.target = '_blank';
    a.style = 'display:flex; width:100%; text-decoration:none; color:inherit;';

    const bar = document.createElement('div');
    bar.className = 'fake-player-bar';

    const emoji = document.createElement('div');
    emoji.className = 'play-emoji';
    emoji.textContent = '▶️';

    const track = document.createElement('div');
    track.className = 'progress-track';
    const fill = document.createElement('div');
    fill.className = 'progress-fill';
    track.appendChild(fill);

    bar.appendChild(emoji);
    bar.appendChild(track);

    const label = document.createElement('div');
    label.className = 'audio-label';
    label.textContent = text;

    a.appendChild(bar);
    a.appendChild(label);

    wrapper.appendChild(del);
    wrapper.appendChild(a);

    audioLinksSec.appendChild(wrapper);

    linkText.focus();
  };



  // ADD SECTION (FIXED: add editMode to delBtn and spacer)
  $('#btnAdd').onclick = () => {
    const clone = $('#sectionTemplate').cloneNode(true);
    clone.removeAttribute('id');
    clone.style.display = 'block';
    clone.className = 'section';
    clone.contentEditable = 'true';

    const delBtn = clone.querySelector('.delBtn');
    delBtn.classList.add('editMode');
    delBtn.onclick = () => clone.remove();

    container.appendChild(clone);

    const sp = document.createElement('div');
    sp.className = 'edit-spacer editMode';
    sp.contentEditable = 'false';
    container.appendChild(sp);
  };

  // SAVE (WORKS: hides only editMode, restores, saves clean)
$('#btnSave').onclick = () => {
  // 1. Update <title>
  const h2 = document.getElementById('articleTitle');
  const title = document.querySelector('title');
  if (h2 && title) title.textContent = h2.textContent.trim();


  // 3. HIDE editMode elements
  const editElements = document.querySelectorAll('.editMode');
  editElements.forEach(el => el.style.display = 'none');

  // 4. DISABLE contenteditable
  const editableEls = document.querySelectorAll('[contenteditable]');
  const wasEditable = [];
  editableEls.forEach(el => {
    wasEditable.push(el);
    el.removeAttribute('contenteditable');
  });

  // 5. Capture clean HTML
  const cleanHTML = '<!DOCTYPE html>\n' + document.documentElement.outerHTML;

  // 6. RESTORE contenteditable
  wasEditable.forEach(el => el.setAttribute('contenteditable', 'true'));

  // 7. RESTORE visibility
  editElements.forEach(el => el.style.display = 'block');

  // 8. Download
  const blob = new Blob([cleanHTML], { type: 'text/html' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = fileIn.value.trim() || 'podcast.html';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
title.textContent="webpageMaker";

  // 9. Alert and confirm save editable version
let saveEditableVersion = confirm("Saved to default download folder.\nSave an editable version?");

if (!saveEditableVersion) return;  // Exit function if Cancel

  // === 10. SAVE EDITABLE VERSION ===
const editHTML = '<!DOCTYPE html>\n' + document.documentElement.outerHTML;
const editBlob = new Blob([editHTML], { type: 'text/html' });
const editUrl = URL.createObjectURL(editBlob);
const editA = document.createElement('a');
const baseName = fileIn.value.trim() || 'podcast.html';
const editName = baseName.replace(/\.html$/, '') + 'EditMode.html';
editA.href = editUrl;
editA.download = editName;
document.body.appendChild(editA);
editA.click();
document.body.removeChild(editA);
URL.revokeObjectURL(editUrl);
title.textContent="webpageMaker";
};

  // Enter = Add Link
  linkText.onkeypress = linkUrl.onkeypress = e => {
    if (e.key === 'Enter') $('#btnAddLink').click();
  };


});


//Code for Making Lists
document.getElementById('formatBtn').addEventListener('click', function() {
    const selection = window.getSelection();

    if (!selection.rangeCount || selection.toString().trim() === '') {
        alert('Please select some text first');
        return;
    }

    // Check if OL is selected
    const useOL = document.getElementById('olCheckbox').checked;
    const listTag = useOL ? 'ol' : 'ul';

    // Get the range and extract the contents (preserves formatting)
    const range = selection.getRangeAt(0);
    const selectedFragment = range.cloneContents();

    // Create a temporary container to work with the HTML
    const tempDiv = document.createElement('div');
    tempDiv.appendChild(selectedFragment);

    // Get the HTML with formatting preserved
    let selectedHTML = tempDiv.innerHTML.trim();

    // Remove all <br> tags (including <br/> and <br />)
    selectedHTML = selectedHTML.replace(/<br\s*\/?>/gi, '');

    // Remove leading ^^ (checking both plain and within tags)
    selectedHTML = selectedHTML.replace(/^\^\^/, '').trim();

    // Remove trailing ^^
    selectedHTML = selectedHTML.replace(/\^\^$/, '').trim();

    // Create the list structure with the chosen list type
    let newTextList = '<' + listTag + '><li>' + selectedHTML + '</li></' + listTag + '>';

    // Replace ^^ with list item breaks
    let finalTextList = newTextList.replace(/\^\^/g, '</li><li>');

    // Remove whitespace after <li> and before </li>
    finalTextList = finalTextList.replace(/<li>\s+/g, '<li>');
    finalTextList = finalTextList.replace(/\s+<\/li>/g, '</li>');

    // Replace the selected text with the formatted list
    range.deleteContents();

    const newTempDiv = document.createElement('div');
    newTempDiv.innerHTML = finalTextList;
    const fragment = document.createDocumentFragment();
    while (newTempDiv.firstChild) {
        fragment.appendChild(newTempDiv.firstChild);
    }

    range.insertNode(fragment);

});

</script>
</body>
</html>
