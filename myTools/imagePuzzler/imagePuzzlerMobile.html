<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>25-Piece Puzzle - Final Perfect Version</title>
<style>
  body { margin:0; padding:15px; background:#111; color:#eee; font-family:system-ui,sans-serif; text-align:center; }
  h1 { font-size:1.8em; margin:10px 0; }
  input, button { margin:8px; padding:12px; font-size:16px; border-radius:8px; }
  button { background:#333; color:white; border:2px solid #666; cursor:pointer; }
  button:active { background:#555; }

  .container {
    width:100%; max-width:510px; margin:20px auto;
    aspect-ratio:1/1; border:8px solid #555; border-radius:16px; overflow:hidden;
    position:relative; box-shadow:0 10px 30px rgba(0,0,0,0.8);
  }
  #puzzle {
    display:grid; grid-template-columns:repeat(5,1fr); gap:0;
    width:100%; height:100%; background:black;
  }
  #original-container { display:none; }
  #original-image {
    width:100%; height:100%;
    object-fit: cover;           /* This is the magic! */
    object-position: center;
  }

  .tile {
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    transition:transform .25s, box-shadow .25s;
    box-shadow:0 2px 8px rgba(0,0,0,0.9);
  }
  .tile:active { transform:scale(0.94); }

  .preview-wrong { box-shadow:0 0 35px 8px yellow !important; transform:scale(0.97); }
  .preview-correct { box-shadow:0 0 40px 10px #00ddff !important; transform:scale(0.97); }
  .selected { outline:6px solid yellow; transform:scale(0.90) !important; z-index:10; }
  .correct-flash { animation:correctPulse 1s ease-out; }
  @keyframes correctPulse {
    0%   { transform:scale(0.90); box-shadow:0 0 40px lime; }
    50%  { transform:scale(1.06); box-shadow:0 0 70px lime; }
    100% { transform:scale(1); }
  }
</style>
</head>
<body>

<h1>25-Piece Puzzle</h1>
<p>Tap two tiles to swap<br><b>Long-press</b> to preview if correct</p>

<input type="text" id="imgUrl" placeholder="Any image URL" value="https://picsum.photos/1200/800">
<button onclick="init()">New Puzzle</button>
<button id="toggleBtn" onclick="toggleView()">View Original</button>

<div class="container">
  <div id="puzzle"></div>
</div>
<div class="container" id="original-container">
  <img id="original-image" src="" alt="Original">
</div>

<small>Works with any image shape • Never distorts • Centers perfectly</small>

<script>
const GRID = 5;
let tiles = [], selected = null, currentUrl = '', longPressTimer = null;

function init() {
  currentUrl = document.getElementById('imgUrl').value.trim() || 'https://picsum.photos/1200/800';
  document.getElementById('original-image').src = currentUrl;

  const puzzle = document.getElementById('puzzle');
  puzzle.innerHTML = '';
  tiles = [];

  const container = puzzle.parentElement;
  const size = container.offsetWidth;
  const tilePx = size / GRID;

  for (let i = 0; i < 25; i++) {
    const tile = document.createElement('div');
    tile.className = 'tile';

    const row = Math.floor(i / GRID), col = i % GRID;

    tile.style.backgroundImage = `url(${currentUrl})`;
    // This is the key: cover + center = perfect crop
    tile.style.backgroundSize = 'cover';
    tile.style.backgroundPosition = 'center';

    tile.dataset.original = i;
    tile.dataset.pos = i;
    tile.style.gridRow = row + 1;
    tile.style.gridColumn = col + 1;

    // Touch handling
    tile.onpointerdown = () => {
      longPressTimer = setTimeout(() => {
        longPressTimer = null;
        const correct = tile.dataset.pos === tile.dataset.original;
        tile.classList.add(correct ? 'preview-correct' : 'preview-wrong');
        if ('vibrate' in navigator) navigator.vibrate(50);
      }, 700);
    };
    tile.onpointerup = tile.onpointercancel = tile.onpointerleave = () => {
      if (longPressTimer) {
        clearTimeout(longPressTimer);
        longPressTimer = null;
      } else {
        setTimeout(() => tile.classList.remove('preview-correct','preview-wrong'), 300);
      }
    };
    tile.onclick = (e) => {
      if (longPressTimer) { e.preventDefault(); return; }
      select(tile);
    };

    puzzle.appendChild(tile);
    tiles.push(tile);
  }

  document.querySelector('.container').style.display = 'block';
  document.getElementById('original-container').style.display = 'none';
  document.getElementById('toggleBtn').textContent = 'View Original';

  shuffle();
}

function select(tile) {
  if (selected === tile) { tile.classList.remove('selected'); selected = null; return; }
  if (!selected) { selected = tile; tile.classList.add('selected'); return; }

  [tile.style.gridRow, selected.style.gridRow] = [selected.style.gridRow, tile.style.gridRow];
  [tile.style.gridColumn, selected.style.gridColumn] = [selected.style.gridColumn, tile.style.gridColumn];
  [tile.dataset.pos, selected.dataset.pos] = [selected.dataset.pos, tile.dataset.pos];

  updateCorrectState(selected);
  updateCorrectState(tile);

  selected.classList.remove('selected');
  selected = null;
  checkWin();
}

function updateCorrectState(tile) {
  const correct = tile.dataset.pos === tile.dataset.original;
  if (correct && !tile.classList.contains('just-corrected')) {
    tile.classList.add('correct-flash','just-corrected');
    if ('vibrate' in navigator) navigator.vibrate([100,50,100]);
    setTimeout(() => tile.classList.remove('correct-flash','just-corrected'), 1000);
  }
}

function shuffle() {
  const pos = Array.from({length:25},(_,i)=>i);
  for (let i=pos.length-1; i>0; i--) {
    const j = Math.floor(Math.random()*(i+1));
    [pos[i],pos[j]] = [pos[j],pos[i]];
  }
  tiles.forEach((t,idx) => {
    const p = pos[idx];
    t.style.gridRow = Math.floor(p/5)+1;
    t.style.gridColumn = (p%5)+1;
    t.dataset.pos = p;
    updateCorrectState(t);
  });
}

function toggleView() {
  const p = document.querySelector('.container');
  const o = document.getElementById('original-container');
  const b = document.getElementById('toggleBtn');
  if (p.style.display !== 'none') {
    p.style.display = 'none'; o.style.display = 'block'; b.textContent = 'Back to Puzzle';
  } else {
    p.style.display = 'block'; o.style.display = 'none'; b.textContent = 'View Original';
  }
}

function checkWin() {
  if (tiles.every(t => t.dataset.pos === t.dataset.original)) {
    setTimeout(() => alert('Puzzle Complete! You are a legend!'), 600);
  }
}

window.onload = init;
</script>
</body>
</html>
